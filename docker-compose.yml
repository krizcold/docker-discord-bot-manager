name: discordbotmanager

services:
  discordbotmanager:
    image: ghcr.io/yundera/nginx-hash-lock:latest
    restart: unless-stopped
    expose:
      - "80"
    user: "root"
    environment:
      AUTH_HASH: $AUTH_HASH
      BACKEND_HOST: "discordbotmanagerapp"
      BACKEND_PORT: "8080"
      LISTEN_PORT: "80"
      ALLOWED_EXTENSIONS: "js,jsx,css,png,ico,svg,jpg,jpeg,gif,woff,woff2,ttf,eot"
    depends_on:
      - discordbotmanagerapp
    networks:
      - pcs
    privileged: true
    cap_add:
      - SYS_ADMIN
      - NET_ADMIN

  discordbotmanagerapp:
    image: ghcr.io/krizcold/docker-discord-bot-manager:latest
    container_name: discordbotmanagerapp
    restart: unless-stopped
    user: "root"
    environment:
      NODE_ENV: production
      DATA_DIR: /data
      PORT: 8080
      API_HASH: $API_HASH

      # Hardcoded/built-in variables
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      DefaultUserName: $DefaultUserName
      DefaultPassword: $DefaultPassword

      # CasaOS container OS environment variables
      default_pwd: $default_pwd
      public_ip: $public_ip
      domain: $domain
      USER: $USER

      # PCS environment variables
      PCS_DEFAULT_PASSWORD: $PCS_DEFAULT_PASSWORD
      PCS_DOMAIN: $PCS_DOMAIN
      PCS_DATA_ROOT: $PCS_DATA_ROOT
      PCS_PUBLIC_IP: $PCS_PUBLIC_IP
      PCS_PUBLIC_IPV6: $PCS_PUBLIC_IPV6
      PCS_EMAIL: $PCS_EMAIL

      # REF variables
      REF_DOMAIN: $REF_DOMAIN
      REF_NET: $REF_NET
      REF_SCHEME: $REF_SCHEME
      REF_PORT: $REF_PORT
      REF_SEPARATOR: $REF_SEPARATOR
      REF_DEFAULT_PORT: $REF_DEFAULT_PORT

      # Data root
      DATA_ROOT: $DATA_ROOT

      # SMTP variables
      SMTP_HOST: $SMTP_HOST
      SMTP_PORT: $SMTP_PORT
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
      - type: bind
        source: $DATA_ROOT/AppData/discordbotmanager/data
        target: /data
      - type: bind
        source: $DATA_ROOT/AppData
        target: /DATA/AppData
    networks:
      - pcs
    expose:
      - 8080

    privileged: true
    cap_add:
      - SYS_ADMIN
      - NET_ADMIN

    cpu_shares: 50
    deploy:
      resources:
        limits:
          memory: 512M

    x-casaos:
      volumes:
        - container: /var/run/docker.sock
          description:
            en_us: Docker socket for container management.
        - container: /data
          description:
            en_us: Persistent data directory for bot configurations and registry.
        - container: /DATA/AppData
          description:
            en_us: CasaOS AppData directory for metadata placement and volume management.

networks:
  pcs:
    external: true

x-casaos:
  architectures:
    - amd64
    - arm64
  main: discordbotmanager
  author: kriz_cold
  developer: kriz_cold
  icon: https://cdn.jsdelivr.net/gh/krizcold/AppStore@main/Apps/DiscordBotManager/icon.png
  tagline:
    en_us: "Manage multiple Discord bots from GitHub repositories"
  category: Utilities
  description:
    en_us: "A Docker-based platform for managing Discord bots. Import bots from GitHub, configure environment variables, and manage deployments with automatic updates."
  title:
    en_us: "Discord Bot Manager"
  store_app_id: discordbotmanager
  is_uncontrolled: false
  index: /?hash=$AUTH_HASH
  port_map: "80"
  webui_port: 80
